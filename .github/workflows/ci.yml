name: monument-ci

on:
  workflow_dispatch:
  push:
  pull_request:

jobs:
  sanity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1) Hard fail if placeholder/template text leaks into real entries
      - name: No TEMPLATE placeholders
        run: |
          set -euo pipefail

          # Scan THEOREMS/ but exclude the template folder and the index itself
          if grep -RIn \
            --exclude-dir=000_TEMPLATE_MONUMENT_ENTRY \
            --exclude=INDEX.md \
            "TEMPLATE" THEOREMS; then
            echo "FAIL: placeholder text found in real theorem entries."
            exit 1
          fi

          # Separately scan the index (clear error message)
          if grep -In "TEMPLATE" THEOREMS/INDEX.md; then
            echo "FAIL: placeholder text found in THEOREMS/INDEX.md"
            exit 1
          fi

      # 2) Basic structure check (prevents empty/forgotten folders)
      - name: Required files exist
        run: |
          set -euo pipefail
          test -d THEOREMS
          test -f THEOREMS/INDEX.md
